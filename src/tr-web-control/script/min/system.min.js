var system = { version: "1.6.0", rootPath: "tr-web-control/", codeupdate: "20190724", configHead: "transmission-web-control", config: { autoReload: !0, reloadStep: 5e3, pageSize: 30, pagination: !0, pageList: [10, 20, 30, 40, 50, 100, 150, 200, 250, 300, 5e3], defaultSelectNode: null, autoExpandAttribute: !1, defaultLang: "", foldersShow: !1, theme: "default", showBTServers: !1, ipInfoToken: "", ui: { status: { tree: {}, layout: { main: {}, body: {}, left: {} }, panel: {}, size: { nav: {}, attribute: {} } } }, hideSubfolders: !1, simpleCheckMode: !1, nav: { servers: !0, folders: !0, statistics: !0, labels: !1 }, labels: [], labelMaps: {}, ignoreVersion: [] }, storageKeys: { dictionary: { folders: "dictionary.folders" } }, dictionary: { folders: null }, checkUpdateScript: "https://api.github.com/repos/ronggang/transmission-web-control/releases/latest", contextMenus: {}, panel: null, lang: null, reloading: !1, autoReloadTimer: null, downloadDir: "", islocal: !1, B64: new Base64, currentTorrentId: 0, control: { tree: null, torrentlist: null }, userConfig: { torrentList: { fields: [], sortName: null, sortOrder: "asc" } }, serverConfig: null, serverSessionStats: null, templates: {}, checkedRows: [], uiIsInitialized: !1, popoverCount: 0, currentListDir: "", setlang: function (t, e) { t || (t = this.config.defaultLang ? this.config.defaultLang : navigator.language || navigator.browserLanguage), t || (t = "zh-CN"), -1 != t.indexOf("-") && (t = t.split("-")[0].toLocaleLowerCase() + "-" + t.split("-")[1].toLocaleUpperCase()), this.languages[t] || (t = "en"), t = t.replace("-", "_"), $.getJSON(system.rootPath + "i18n/" + t + ".json", function (s) { s && (system.lang = $.extend(!0, system.defaultLang, s)), system.resetLangText(), $.getScript(system.rootPath + "script/easyui/locale/easyui-lang-" + t + ".js").done(function (t, s) { e && e() }).fail(function (t, s, n) { $.getScript(system.rootPath + "script/easyui/locale/easyui-lang-en.js", function () { e && e() }) }) }) }, init: function (t, e, s) { this.readConfig(), this.lastUIStatus = JSON.parse(JSON.stringify(this.config.ui.status)), this.islocal = 1 == e, this.panel = { main: $("#main"), top: $("#m_top"), toolbar: $("#m_toolbar"), left_layout: $("#m_left_layout"), left: $("#m_left"), body: $("#m_body"), layout_body: $("#layout_body"), layout_left: $("#layout_left"), list: $("#m_list"), attribute: $("#m_attribute"), bottom: $("#m_bottom"), title: $("#m_title"), status: $("#m_status"), statusbar: $("#m_statusbar"), status_text: $("#status_text"), droparea: $("#dropArea") }, null == this.lang ? this.setlang(t, function () { system.initdata() }) : this.initdata(), this.initThemes(), this.clipboard = new ClipboardJS("#toolbar_copyPath") }, resetLangText: function (parent) { parent || (parent = $); var items = parent.find("*[system-lang]"); $.each(items, function (key, item) { var name = $(item).attr("system-lang"); "[" == name.substr(0, 1) ? $(item).html(eval("system.lang" + name)) : $(item).html(eval("system.lang." + name)) }), items = parent.find("*[system-tip-lang]"), $.each(items, function (key, item) { var name = $(item).attr("system-tip-lang"); "[" == name.substr(0, 1) ? $(item).attr("title", eval("system.lang" + name)) : $(item).attr("title", eval("system.lang." + name)) }) }, initdata: function () { $(document).attr("title", this.lang.system.title + " " + this.version), $.fn.switchbutton.defaults.onText = this.lang.public["text-on"], $.fn.switchbutton.defaults.offText = this.lang.public["text-off"]; var t = new Array, e = "<span>" + this.lang.title.left + "</span>"; if (t.length > 1) for (var s in e += t.join(""), this.panel.left_layout.panel("setTitle", e), this.lang.tree.toolbar.nav) switch ($("#tree-toolbar-nav-" + s).linkbutton(), s) { case "folders": system.config.foldersShow ? $("tree-toolbar-nav-" + s).linkbutton({ iconCls: "icon-enabled" }).data("status", 1) : $("tree-toolbar-nav-" + s).linkbutton({ iconCls: "icon-disabled" }).data("status", 0) } else this.panel.left_layout.panel("setTitle", e); if (e = "<span>" + this.lang.title.list + "</span>", t.length = 0, t.length > 1) for (var s in e += t.join(""), this.panel.body.panel("setTitle", e), this.lang["torrent-head"].buttons) switch ($("#torrent-head-buttons-" + s).linkbutton(), s) { case "autoExpandAttribute": system.config.autoExpandAttribute ? $("#torrent-head-buttons-" + s).linkbutton({ iconCls: "icon-enabled" }).data("status", 1) : $("#torrent-head-buttons-" + s).linkbutton({ iconCls: "icon-disabled" }).data("status", 0) } else this.panel.body.panel("setTitle", e); this.panel.status.panel("setTitle", this.lang.title.status), this.panel.attribute.panel({ title: this.lang.title.attribute, onExpand: function () { 0 != system.currentTorrentId && $(this).data("isload") ? system.getTorrentInfos(system.currentTorrentId) : system.clearTorrentAttribute() }, onLoad: function () { $(this).data("isload") || ($(this).data("isload", !0), 0 != system.currentTorrentId && setTimeout(function () { system.getTorrentInfos(system.currentTorrentId) }, 500)) } }), $.each(this.languages, function (t, e) { $("<option/>").text(e).val(t).attr("selected", t == system.lang.name).appendTo(system.panel.top.find("#lang")) }), this.panel.top.find("#lang").change(function () { location.href = "?lang=" + this.value }), this.panel.toolbar.attr("class", "panel-header"), this.initTree(), this.initToolbar(), this.initStatusBar(), this.initTorrentTable(), this.connect(), this.initEvent(), this.checkUpdate() }, initEvent: function () { $(window).resize(function () { $("#main").layout("resize") }), this.panel.droparea[0].addEventListener("dragover", function (t) { t.stopPropagation(), t.preventDefault(), system.debug("#dropArea.dragover") }, !1), this.panel.list[0].addEventListener("dragover", function (t) { t.stopPropagation(), t.preventDefault(), system.panel.droparea.show(), system.debug("dragover") }, !1), this.panel.droparea[0].addEventListener("drop", function (t) { t.stopPropagation(), t.preventDefault(), system.panel.droparea.hide(), system.debug("drop.e.dataTransfer:", t.dataTransfer), system.checkDropFiles(t.dataTransfer.files) }, !1), this.panel.droparea[0].addEventListener("dragleave", function (t) { t.stopPropagation(), t.preventDefault(), system.panel.droparea.hide(), system.debug("dragleave") }, !1), $("#text-drop-title").html(this.lang.public["text-drop-title"]), $("#button-cancel-checked").on("click", function () { system.control.torrentlist.datagrid("uncheckAll") }), this.panel.left.tree({ onExpand: function (t) { system.config.ui.status.tree[t.id] = t.state, system.saveConfig() }, onCollapse: function (t) { system.config.ui.status.tree[t.id] = t.state, system.saveConfig() } }), this.panel.layout_body.layout({ onExpand: function (t) { system.config.ui.status.layout.body[t] = "open", system.saveConfig() }, onCollapse: function (t) { system.config.ui.status.layout.body[t] = "closed", system.saveConfig() } }), this.panel.layout_left.layout({ onExpand: function (t) { system.config.ui.status.layout.left[t] = "open", system.saveConfig() }, onCollapse: function (t) { system.config.ui.status.layout.left[t] = "closed", system.saveConfig() } }), this.panel.main.layout({ onExpand: function (t) { system.config.ui.status.layout.main[t] = "open", system.saveConfig() }, onCollapse: function (t) { system.config.ui.status.layout.main[t] = "closed", system.saveConfig() } }) }, layoutResize: function (t, e) { system.uiIsInitialized && system.config.ui.status.size[t] && (system.config.ui.status.size[t] = e, system.saveConfig()) }, navToolbarClick: function (t) { var e = t.id, s = $(t).data("status"), n = null; switch (e) { case "tree-toolbar-nav-folders": n = this.panel.left.tree("find", "folders"), this.config.foldersShow = 1 != s; break; case "tree-toolbar-nav-statistics": n = this.panel.left.tree("find", "statistics"); break; case "torrent-head-buttons-autoExpandAttribute": (n = {}).target = null, this.config.autoExpandAttribute = 1 != s }n && (1 == s ? ($(t).linkbutton({ iconCls: "icon-disabled" }), $(n.target).parent().hide(), s = 0) : ($(t).linkbutton({ iconCls: "icon-enabled" }), $(n.target).parent().show(), s = 1), $(t).data("status", s), this.saveConfig()) }, checkDropFiles: function (t) { if (t && t.length) { for (var e = new Array, s = 0; s < t.length; s++) { var n = t[s]; "torrent" == n.name.split(".").pop().toLowerCase() && e.push(n) } e.length > 0 && system.openDialogFromTemplate({ id: "dialog-torrent-addfile", options: { title: system.lang.toolbar["add-torrent"], width: 620, height: system.config.nav.labels ? 500 : 300, resizable: !0 }, datas: { files: e } }) } }, initTree: function () { var t = [{ id: "torrent-all", iconCls: "iconfont tr-icon-home", text: this.lang.tree.all + " (" + this.lang.tree.status.loading + ")", children: [{ id: "downloading", text: this.lang.tree.downloading, iconCls: "iconfont tr-icon-download" }, { id: "paused", text: this.lang.tree.paused, iconCls: "iconfont tr-icon-pause2" }, { id: "sending", text: this.lang.tree.sending, iconCls: "iconfont tr-icon-upload" }, { id: "check", text: this.lang.tree.check, iconCls: "iconfont tr-icon-data-check" }, { id: "actively", text: this.lang.tree.actively, iconCls: "iconfont tr-icon-actively" }, { id: "error", text: this.lang.tree.error, iconCls: "iconfont tr-icon-errors" }, { id: "warning", text: this.lang.tree.warning, iconCls: "iconfont tr-icon-warning" }] }], e = { servers: { id: "servers", text: this.lang.tree.servers, state: "closed", iconCls: "iconfont tr-icon-servers", children: [{ id: "servers-loading", text: this.lang.tree.status.loading, iconCls: "tree-loading" }] }, folders: { id: "folders", text: this.lang.tree.folders, iconCls: "iconfont tr-icon-folder", state: "closed", children: [{ id: "folders-loading", text: this.lang.tree.status.loading, iconCls: "tree-loading" }] }, statistics: { id: "statistics", text: this.lang.tree.statistics.title, state: "closed", iconCls: "iconfont tr-icon-shuju", children: [{ id: "cumulative-stats", text: this.lang.tree.statistics.cumulative, iconCls: "iconfont tr-icon-folder", children: [{ id: "uploadedBytes", text: this.lang.tree.statistics.uploadedBytes, iconCls: "iconfont tr-icon-empty" }, { id: "downloadedBytes", text: this.lang.tree.statistics.downloadedBytes, iconCls: "iconfont tr-icon-empty" }, { id: "filesAdded", text: this.lang.tree.statistics.filesAdded, iconCls: "iconfont tr-icon-empty" }, { id: "sessionCount", text: this.lang.tree.statistics.sessionCount, iconCls: "iconfont tr-icon-empty" }, { id: "secondsActive", text: this.lang.tree.statistics.secondsActive, iconCls: "iconfont tr-icon-empty" }] }, { id: "current-stats", text: this.lang.tree.statistics.current, iconCls: "iconfont tr-icon-folder", children: [{ id: "current-uploadedBytes", text: this.lang.tree.statistics.uploadedBytes, iconCls: "iconfont tr-icon-empty" }, { id: "current-downloadedBytes", text: this.lang.tree.statistics.downloadedBytes, iconCls: "iconfont tr-icon-empty" }, { id: "current-filesAdded", text: this.lang.tree.statistics.filesAdded, iconCls: "iconfont tr-icon-empty" }, { id: "current-sessionCount", text: this.lang.tree.statistics.sessionCount, iconCls: "iconfont tr-icon-empty" }, { id: "current-secondsActive", text: this.lang.tree.statistics.secondsActive, iconCls: "iconfont tr-icon-empty" }] }] }, labels: { id: "labels", text: this.lang.tree.labels, iconCls: "iconfont tr-icon-labels" } }; for (var s in this.config.nav) { var n = this.config.nav[s], o = e[s]; o && n && t.push(o) } this.panel.left.tree({ data: t, onSelect: function (t) { system.loadTorrentToList({ node: t }), system.currentListDir = t.downDir }, lines: !0 }) }, initUIStatus: function () { if (!this.uiIsInitialized) { system.uiIsInitialized = !0; var t = this.lastUIStatus.tree; for (var e in t) { var s; (s = this.panel.left.tree("find", e)) && s.target && ("open" == t[e] ? this.panel.left.tree("expand", s.target) : this.panel.left.tree("collapse", s.target)) } if (this.config.defaultSelectNode) (s = this.panel.left.tree("find", this.config.defaultSelectNode)) && (this.config.foldersShow || -1 == this.config.defaultSelectNode.indexOf("folders")) ? this.panel.left.tree("select", s.target) : (s = this.panel.left.tree("find", "torrent-all"), this.panel.left.tree("select", s.target)); for (var e in this.lastUIStatus.size.nav && this.lastUIStatus.size.nav.width && (this.panel.main.layout("panel", "west").panel("resize", { width: this.lastUIStatus.size.nav.width + 5 }), this.panel.main.layout("resize")), this.lastUIStatus.size.attribute && this.lastUIStatus.size.attribute.height && (this.panel.layout_body.layout("panel", "south").panel("resize", { height: this.lastUIStatus.size.attribute.height }), this.panel.layout_body.layout("resize")), t = this.lastUIStatus.layout.body) "open" == t[e] ? this.panel.layout_body.layout("expand", e) : this.panel.layout_body.layout("collapse", e); for (var e in t = this.lastUIStatus.layout.left) "open" == t[e] ? this.panel.layout_left.layout("expand", e) : this.panel.layout_left.layout("collapse", e); for (var e in t = this.lastUIStatus.layout.main) "open" == t[e] ? this.panel.main.layout("expand", e) : this.panel.main.layout("collapse", e) } }, initTorrentTable: function () { this.control.torrentlist = $("<table/>").attr("class", "torrent-list").appendTo(this.panel.list); var t = null, e = -1; $.get(system.rootPath + "template/torrent-fields.json?time=" + new Date, function (s) { for (var n = s.fields, o = {}, a = 0; a < n.length; a++) { o[(i = n[a]).field] = i } for (var r in 0 != system.userConfig.torrentList.fields.length && (n = $.extend(n, system.userConfig.torrentList.fields)), system.userConfig.torrentList.fields = n, n) { var i, l = o[(i = n[r]).field]; l && l.formatter ? i.formatter = l.formatter : i.formatter && delete i.formatter, l && l.sortable ? i.sortable = l.sortable : i.sortable && delete i.sortable, i.title = system.lang.torrent.fields[i.field] || i.field, system.setFieldFormat(i) } system.control.torrentlist.datagrid({ autoRowHeight: !1, pagination: system.config.pagination, rownumbers: !0, remoteSort: !1, checkOnSelect: !1, pageSize: system.config.pageSize, pageList: system.config.pageList, idField: "id", fit: !0, striped: !0, sortName: system.userConfig.torrentList.sortName, sortOrder: system.userConfig.torrentList.sortOrder, drophead: !0, columns: [n], onCheck: function (t, e) { system.checkTorrentRow(t, e) }, onUncheck: function (t, e) { system.checkTorrentRow(t, e) }, onCheckAll: function (t) { system.checkTorrentRow("all", !1) }, onUncheckAll: function (t) { system.checkTorrentRow("all", !0) }, onSelect: function (t, s) { -1 != e && system.control.torrentlist.datagrid("unselectRow", e), system.getTorrentInfos(s.id), e = t }, onUnselect: function (t, s) { system.currentTorrentId = 0, e = -1 }, onBeforeLoad: function (t) { system.currentTorrentId = 0 }, onSortColumn: function (t, e) { var s = t, n = system.control.torrentlist.datagrid("getData").originalRows.sort(arrayObjectSort(s, e)); system.control.torrentlist.datagrid("loadData", n), system.resetTorrentListFieldsUserConfig(system.control.torrentlist.datagrid("options").columns[0]), system.userConfig.torrentList.sortName = t, system.userConfig.torrentList.sortOrder = e, system.saveUserConfig() }, onRowContextMenu: function (t, e, s) { system.config.simpleCheckMode && system.control.torrentlist.datagrid("uncheckAll"), 0 == system.checkedRows.length && system.control.torrentlist.datagrid("checkRow", e), t.preventDefault(), system.showContextMenu("torrent-list", t) }, onHeadDrop: function (t, e) { system.resetTorrentListFieldsUserConfig(system.control.torrentlist.datagrid("options").columns[0]), system.saveUserConfig() }, onResizeColumn: function (t, e) { system.resetTorrentListFieldsUserConfig(system.control.torrentlist.datagrid("options").columns[0]), system.saveUserConfig() }, onHeaderContextMenu: function (e, s) { e.preventDefault(), t || function () { t && $(t).remove(); (t = $("<div/>").appendTo("body")).menu({ onClick: function (e) { "icon-ok" == e.iconCls ? (system.control.torrentlist.datagrid("hideColumn", e.name), t.menu("setIcon", { target: e.target, iconCls: "icon-empty" })) : (system.control.torrentlist.datagrid("showColumn", e.name), t.menu("setIcon", { target: e.target, iconCls: "icon-ok" })), system.resetTorrentListFieldsUserConfig(system.control.torrentlist.datagrid("options").columns[0]), system.saveUserConfig() } }); for (var e = system.control.torrentlist.datagrid("getColumnFields"), s = 0; s < e.length; s++) { var n = e[s], o = system.control.torrentlist.datagrid("getColumnOption", n); 0 != o.allowCustom && "false" != o.allowCustom && t.menu("appendItem", { text: o.title, name: n, iconCls: o.hidden ? "icon-empty" : "icon-ok" }) } }(), t.menu("show", { left: e.pageX, top: e.pageY }) } }) }, "json"), this.control.torrentlist.refresh = function () { system.control.torrentlist.datagrid("getPager").find(".pagination-load").click() } }, resetTorrentListFieldsUserConfig: function (t) { var e = {}; $.each(this.userConfig.torrentList.fields, function (t, s) { e[s.field] = s }), this.userConfig.torrentList.fields = [], $.each(t, function (t, s) { var n = $.extend({}, e[s.field]); n.width = s.width, n.hidden = s.hidden, system.userConfig.torrentList.fields.push(n) }) }, showContextMenu: function (t, e) { var s = this.contextMenus[t]; s ? s.empty() : (s = $("<div/>").attr("class", "easyui-menu").css({ "min-width": "180px" }).appendTo(this.panel.main), this.contextMenus[t] = s, s.menu()); var n = null; switch (t) { case "torrent-list": n = new Array("start", "pause", "-", "rename", "remove", "recheck", "-", "morepeers", "changeDownloadDir", "copyPath", "-", "menu-queue-move-top", "menu-queue-move-up", "menu-queue-move-down", "menu-queue-move-bottom", "magnetLink"), this.config.nav.labels && (n.push("-"), n.push("setLabels")); var o = this.panel.toolbar; for (var a in n) { var r = n[a]; if ("-" == r) $("<div class='menu-sep'></div>").appendTo(s); else { var i = o.find("#toolbar_" + r); i.length > 0 ? s.menu("appendItem", { text: i.attr("title"), id: r, iconCls: i.linkbutton("options").iconCls, disabled: i.linkbutton("options").disabled, onclick: function () { system.panel.toolbar.find("#toolbar_" + $(this).attr("id")).click() } }) : (i = $("#" + r)).length > 0 ? s.menu("appendItem", { text: i.attr("title"), id: r, iconCls: i.attr("id").replace("menu-queue-move", "iconfont tr-icon"), disabled: o.find("#toolbar_queue").linkbutton("options").disabled, onclick: function () { $("#" + $(this).attr("id")).click() } }) : (i = this.getContentMenuWithKey(r, s)) && s.menu("appendItem", i), i = null } } var l = $("#copyPath", s); l.attr({ "data-clipboard-action": "copy", "data-clipboard-target": "#clipboard-source" }); new ClipboardJS(l.get(0)) }s.menu("show", { left: e.pageX, top: e.pageY, hideOnUnhover: !1 }), s = null, n = null }, getContentMenuWithKey: function (t, e) { switch (t) { case "setLabels": return { id: "setLabels", text: system.lang.menus.setLabels, iconCls: "iconfont tr-icon-labels", disabled: 0 == this.checkedRows.length, onclick: function () { var t = system.checkedRows, e = new Array; for (var s in t) e.push(t[s].hashString); 0 != e.length && system.openDialogFromTemplate({ id: "dialog-torrent-setLabels", options: { title: system.lang.dialog["torrent-setLabels"].title, width: 520, height: 200 }, datas: { hashs: e } }) } }; case "magnetLink": return { id: "magnetLink", text: system.lang.menus.copyMagnetLink, iconCls: "iconfont tr-icon-labels", disabled: 0 == this.checkedRows.length, onclick: function () { system.getTorrentMagnetLink(function (t) { system.copyToClipboard(t), e.css("display", "block") }) } } } }, formetTorrentLabels: function (t, e) { var s = $("<div style='position: relative;'/>"); if (t) { "string" == typeof t && (t = t.split(",")); for (var n = 0; n < t.length; n++) { var o = t[n], a = this.config.labels[o]; a && $("<span class='user-label'/>").html(a.name).css({ "background-color": a.color, color: getGrayLevel(a.color) > .5 ? "#000" : "#fff" }).appendTo(s) } } var r = $("<button onclick='javascript:system.setTorrentLabels(this,\"" + e + '");\' data-options="iconCls:\'iconfont tr-icon-labels\',plain:true" class="easyui-linkbutton user-label-set"/>').appendTo(s); return r.linkbutton(), r.find("span").first().attr({ title: system.lang.dialog["torrent-setLabels"].title }), s.get(0).outerHTML }, setTorrentLabels: function (t, e) { system.openDialogFromTemplate({ id: "dialog-torrent-setLabels", options: { title: system.lang.dialog["torrent-setLabels"].title, width: 520, height: 200 }, datas: { hashs: [e] }, type: 1, source: $(t) }) }, checkTorrentRow: function (t, e) { if (this.checkedRows = this.control.torrentlist.datagrid("getChecked"), this.showCheckedInStatus(), "all" == t) { if (0 == this.control.torrentlist.datagrid("getRows").length) return; return $("#toolbar_start, #toolbar_pause, #toolbar_remove, #toolbar_recheck, #toolbar_changeDownloadDir,#toolbar_morepeers,#toolbar_copyPath", this.panel.toolbar).linkbutton({ disabled: e }), $("#toolbar_rename, #toolbar_morepeers", this.panel.toolbar).linkbutton({ disabled: !0 }), void this.panel.toolbar.find("#toolbar_queue").menubutton("disable") } if (0 == this.checkedRows.length) return $("#toolbar_start, #toolbar_pause, #toolbar_rename, #toolbar_remove, #toolbar_recheck, #toolbar_changeDownloadDir,#toolbar_morepeers,#toolbar_copyPath", this.panel.toolbar).linkbutton({ disabled: !0 }), void this.panel.toolbar.find("#toolbar_queue").menubutton("disable"); if (1 == this.checkedRows.length) switch ($("#toolbar_remove, #toolbar_rename, #toolbar_changeDownloadDir,#toolbar_copyPath", this.panel.toolbar).linkbutton({ disabled: !1 }), this.panel.toolbar.find("#toolbar_queue").menubutton("enable"), transmission.torrents.all[e.id].status) { case transmission._status.stopped: this.panel.toolbar.find("#toolbar_start, #toolbar_recheck").linkbutton({ disabled: !1 }), this.panel.toolbar.find("#toolbar_pause, #toolbar_morepeers").linkbutton({ disabled: !0 }); break; case transmission._status.check: case transmission._status.checkwait: this.panel.toolbar.find("#toolbar_start, #toolbar_pause, #toolbar_recheck, #toolbar_morepeers").linkbutton({ disabled: !0 }); break; default: this.panel.toolbar.find("#toolbar_start, #toolbar_recheck").linkbutton({ disabled: !0 }), this.panel.toolbar.find("#toolbar_pause, #toolbar_morepeers").linkbutton({ disabled: !1 }) } else $("#toolbar_start, #toolbar_pause, #toolbar_remove, #toolbar_recheck, #toolbar_changeDownloadDir,#toolbar_copyPath", this.panel.toolbar).linkbutton({ disabled: !1 }), $("#toolbar_rename, #toolbar_morepeers", this.panel.toolbar).linkbutton({ disabled: !0 }), this.panel.toolbar.find("#toolbar_queue").menubutton("disable") }, showCheckedInStatus: function () { if (this.checkedRows.length > 0) { this.panel.status_text.empty(), this.showStatus(void 0, 0); var t = [], e = this.lang.system.status.checked.replace("%n", this.checkedRows.length), s = []; $("<div style='padding: 5px;'/>").html(e).appendTo(this.panel.status_text); for (var n = 0; n < this.checkedRows.length; n++) { var o = this.checkedRows[n]; t.push({ value: n, text: n + 1 + ". " + o.name }), -1 === $.inArray(o.downloadDir, s) && s.push(o.downloadDir) } $("<div/>").appendTo(this.panel.status_text).datalist({ data: t }), $(".datalist>.panel-body", this.panel.status_text).css({ border: 0 }), $("#button-cancel-checked").show(), $("#clipboard-source").val(s.join("\n")) } else $("#button-cancel-checked").hide(), this.panel.status_text.empty(), $("#clipboard-source").val("") }, copyToClipboard: function (t) { var e = "copy_to_clipboard_textarea", s = document.getElementById(e); s || (s = document.createElement("textarea")), s.id = e, s.style.display = "block", s.value = t, document.body.appendChild(s), s.select(), document.execCommand("copy"), s.style.display = "none" }, initToolbar: function () { this.panel.toolbar.find("#toolbar_label_reload_time").html(this.lang.toolbar["reload-time"]), this.panel.toolbar.find("#toolbar_label_reload_time_unit").html(this.lang.toolbar["reload-time-unit"]), this.panel.toolbar.find("#toolbar_reload_time").numberspinner({ value: this.config.reloadStep / 1e3, min: 3, disabled: !this.config.autoReload, onChange: function () { var t = this.value; $.isNumeric(t) && (system.config.reloadStep = 1e3 * t, system.saveConfig()) } }), this.panel.toolbar.find("#toolbar_autoreload").linkbutton({ text: this.config.autoReload ? this.lang.toolbar["autoreload-enabled"] : this.lang.toolbar["autoreload-disabled"], iconCls: this.config.autoReload ? "icon-enabled" : "icon-disabled" }).attr("title", this.config.autoReload ? this.lang.toolbar.tip["autoreload-disabled"] : this.lang.toolbar.tip["autoreload-enabled"]).click(function () { system.config.autoReload ? (system.config.autoReload = !1, clearTimeout(system.autoReloadTimer), system.panel.toolbar.find("#toolbar_reload_time").numberspinner("disable")) : (system.config.autoReload = !0, system.reloadData(), system.panel.toolbar.find("#toolbar_reload_time").numberspinner("enable")), system.saveConfig(), $(this).linkbutton({ text: system.config.autoReload ? system.lang.toolbar["autoreload-enabled"] : system.lang.toolbar["autoreload-disabled"], iconCls: system.config.autoReload ? "icon-enabled" : "icon-disabled" }).attr("title", system.config.autoReload ? system.lang.toolbar.tip["autoreload-disabled"] : system.lang.toolbar.tip["autoreload-enabled"]) }), this.panel.toolbar.find("#toolbar_add_torrents").linkbutton({ text: this.lang.toolbar["add-torrent"], disabled: !1 }).attr("title", this.lang.toolbar.tip["add-torrent"]).click(function () { system.openDialogFromTemplate({ id: "dialog-torrent-add", options: { title: system.lang.toolbar["add-torrent"], width: 620, height: system.config.nav.labels ? 600 : 400, resizable: !0 } }) }), this.panel.toolbar.find("#toolbar_start_all").linkbutton({ disabled: !1 }).attr("title", this.lang.toolbar.tip["start-all"]).click(function () { var t = $(this), e = t.linkbutton("options").iconCls; t.linkbutton({ disabled: !0, iconCls: "icon-loading" }), transmission.exec({ method: "torrent-start" }, function (s) { t.linkbutton({ iconCls: e, disabled: !1 }), t = null }) }), this.panel.toolbar.find("#toolbar_pause_all").linkbutton({ disabled: !1 }).attr("title", this.lang.toolbar.tip["pause-all"]).click(function () { var t = $(this), e = t.linkbutton("options").iconCls; t.linkbutton({ disabled: !0, iconCls: "icon-loading" }), transmission.exec({ method: "torrent-stop" }, function (s) { t.linkbutton({ iconCls: e, disabled: !1 }), t = null }) }), this.panel.toolbar.find("#toolbar_start").linkbutton({ disabled: !0 }).attr("title", this.lang.toolbar.tip.start).click(function () { system.changeSelectedTorrentStatus("start", $(this)) }), this.panel.toolbar.find("#toolbar_pause").linkbutton({ disabled: !0 }).attr("title", this.lang.toolbar.tip.pause).click(function () { system.changeSelectedTorrentStatus("stop", $(this)) }), this.panel.toolbar.find("#toolbar_recheck").linkbutton({ disabled: !0 }).attr("title", this.lang.toolbar.tip.recheck).click(function () { var t = system.control.torrentlist.datagrid("getChecked"); t.length > 0 && (1 == t.length ? transmission.torrents.all[t[0].id].percentDone > 0 ? confirm(system.lang.toolbar.tip["recheck-confirm"]) && system.changeSelectedTorrentStatus("verify", $(this)) : system.changeSelectedTorrentStatus("verify", $(this)) : confirm(system.lang.toolbar.tip["recheck-confirm"]) && system.changeSelectedTorrentStatus("verify", $(this))) }), this.panel.toolbar.find("#toolbar_morepeers").linkbutton({ disabled: !0 }).click(function () { system.changeSelectedTorrentStatus("reannounce", $(this)) }), this.panel.toolbar.find("#toolbar_remove").linkbutton({ disabled: !0 }).attr("title", this.lang.toolbar.tip.remove).click(function () { var t = system.control.torrentlist.datagrid("getChecked"), e = new Array; for (var s in t) e.push(t[s].id); 0 != e.length && system.openDialogFromTemplate({ id: "dialog-torrent-remove-confirm", options: { title: system.lang.dialog["torrent-remove"].title, width: 350, height: 150 }, datas: { ids: e } }) }), this.panel.toolbar.find("#toolbar_rename").linkbutton({ disabled: !0 }).click(function () { var t = system.control.torrentlist.datagrid("getChecked"); 0 != t.length && system.openDialogFromTemplate({ id: "dialog-torrent-rename", options: { title: system.lang.dialog["torrent-rename"].title, width: 520, height: 200, resizable: !0 }, datas: { id: t[0].id } }) }), this.panel.toolbar.find("#toolbar_changeDownloadDir").linkbutton({ disabled: !0 }).attr("title", this.lang.toolbar.tip["change-download-dir"]).click(function () { var t = system.control.torrentlist.datagrid("getChecked"), e = new Array; for (var s in t) e.push(t[s].id); 0 != e.length && system.openDialogFromTemplate({ id: "dialog-torrent-changeDownloadDir", options: { title: system.lang.dialog["torrent-changeDownloadDir"].title, width: 520, height: 200 }, datas: { ids: e } }) }), this.panel.toolbar.find("#toolbar_alt_speed").linkbutton().attr("title", this.lang.toolbar.tip["alt-speed"]).click(function () { var t = $(this), e = t.linkbutton("options"), s = !1; "iconfont tr-icon-rocket" == e.iconCls && (s = !0), transmission.exec({ method: "session-set", arguments: { "alt-speed-enabled": s } }, function (e) { "success" == e.result && (system.serverConfig["alt-speed-enabled"] = s, t.linkbutton({ iconCls: "iconfont tr-icon-" + (s ? "woniu" : "rocket") }), s ? $("#status_alt_speed").show() : $("#status_alt_speed").hide()) }), t.linkbutton({ iconCls: "icon-loading" }) }), this.panel.toolbar.find("#toolbar_config").linkbutton().attr("title", this.lang.toolbar.tip["system-config"]).click(function () { system.openDialogFromTemplate({ id: "dialog-system-config", options: { title: system.lang.toolbar["system-config"], width: 680, height: 500, resizable: !0 } }) }), this.panel.toolbar.find("#toolbar_reload").linkbutton().attr("title", this.lang.toolbar.tip["system-reload"]).click(function () { system.reloadData() }), this.panel.toolbar.find("#toolbar_search").searchbox({ searcher: function (t) { system.searchTorrents(t) }, prompt: this.lang.toolbar["search-prompt"] }), this.panel.toolbar.find("#toolbar_copyPath").linkbutton().attr("title", this.lang.toolbar.tip["copy-path-to-clipboard"]) }, initStatusBar: function () { this.panel.statusbar.find("#status_title_downloadspeed").html(this.lang.statusbar.downloadspeed), this.panel.statusbar.find("#status_title_uploadspeed").html(this.lang.statusbar.uploadspeed) }, connect: function () { this.showStatus(this.lang.system.status.connect, 0), transmission.on.torrentCountChange = function () { system.reloadTorrentBaseInfos() }, transmission.on.postError = function () { }, transmission.init({ islocal: !0 }, function () { system.reloadSession(!0), system.getServerStatus() }) }, reloadSession: function (t) { transmission.getSession(function (e) { system.serverConfig = e, $("#status_version").html("Transmission " + system.lang.statusbar.version + e.version + ", RPC: " + e["rpc-version"] + ", WEB Control: " + system.version + "(" + system.codeupdate + ")"), 1 == e["alt-speed-enabled"] ? (system.panel.toolbar.find("#toolbar_alt_speed").linkbutton({ iconCls: "iconfont tr-icon-woniu" }), $("#status_alt_speed").show()) : (system.panel.toolbar.find("#toolbar_alt_speed").linkbutton({ iconCls: "iconfont tr-icon-rocket" }), $("#status_alt_speed").hide()), system.downloadDir = e["download-dir"], 0 == transmission.downloadDirs.length && transmission.downloadDirs.push(system.downloadDir), parseInt(system.serverConfig["rpc-version"]) >= 15 ? transmission.getFreeSpace(system.downloadDir, function (t) { system.serverConfig["download-dir-free-space"] = t.arguments["size-bytes"], system.showFreeSpace(t.arguments["size-bytes"]) }) : system.showFreeSpace(system.serverConfig["download-dir-free-space"]), t && system.showStatus(system.lang.system.status.connected) }) }, showFreeSpace: function (t) { var e = t; e = -1 == e ? system.lang.public["text-unknown"] : formatSize(e), $("#status_freespace").text(system.lang.dialog["system-config"]["download-dir-free-space"] + " " + e) }, reloadTorrentBaseInfos: function (t, e) { if (!this.reloading) { clearTimeout(this.autoReloadTimer), this.reloading = !0; var s = { trackers: transmission.trackers, folders: transmission.torrents.folders }; transmission.torrents.getallids(function (t) { var e = new Array; for (var n in t) { var o = t[n]; e.push(o.id) } var a = transmission.torrents.getErrorIds(e, !0); a.length > 0 ? transmission.torrents.getallids(function () { system.resetTorrentInfos(s) }, a) : system.resetTorrentInfos(s) }, t, e) } }, resetTorrentInfos: function (t) { this.resetNavTorrentStatus(), this.resetNavServers(t), this.resetNavStatistics(), this.resetNavFolders(t), this.resetNavLabels(), "Firefox" == $.ua.browser.name && $.ua.browser.major < 60 && system.panel.left.find("span.nav-total-size").css({ "margin-top": "-19px" }) }, resetNavTorrentStatus: function () { var t = this.currentTorrentId; if (transmission.torrents.status[transmission._status.stopped] ? system.updateTreeNodeText("paused", system.lang.tree.paused + this.showNodeMoreInfos(transmission.torrents.status[transmission._status.stopped].length)) : system.updateTreeNodeText("paused", system.lang.tree.paused), transmission.torrents.status[transmission._status.seed] ? system.updateTreeNodeText("sending", system.lang.tree.sending + this.showNodeMoreInfos(transmission.torrents.status[transmission._status.seed].length)) : system.updateTreeNodeText("sending", system.lang.tree.sending), transmission.torrents.status[transmission._status.seedwait]) { var e = system.panel.left.tree("find", "sending"), s = system.panel.left.tree("getChildren", e.target), n = system.lang.tree.wait + this.showNodeMoreInfos(transmission.torrents.status[transmission._status.seedwait].length); s.length > 0 ? system.updateTreeNodeText(s[0].id, n) : system.appendTreeNode(e, [{ id: "seedwait", text: n, iconCls: "iconfont tr-icon-wait" }]) } else system.removeTreeNode("seedwait"); if (transmission.torrents.status[transmission._status.check] ? system.updateTreeNodeText("check", system.lang.tree.check + this.showNodeMoreInfos(transmission.torrents.status[transmission._status.check].length)) : system.updateTreeNodeText("check", system.lang.tree.check), transmission.torrents.status[transmission._status.checkwait]) { var e = system.panel.left.tree("find", "check"); s = system.panel.left.tree("getChildren", e.target), n = system.lang.tree.wait + this.showNodeMoreInfos(transmission.torrents.status[transmission._status.checkwait].length); s.length > 0 ? system.updateTreeNodeText(s[0].id, n) : system.appendTreeNode(e, [{ id: "checkwait", text: n, iconCls: "iconfont tr-icon-wait" }]) } else system.removeTreeNode("checkwait"); if (transmission.torrents.status[transmission._status.download] ? system.updateTreeNodeText("downloading", system.lang.tree.downloading + this.showNodeMoreInfos(transmission.torrents.status[transmission._status.download].length)) : system.updateTreeNodeText("downloading", system.lang.tree.downloading), transmission.torrents.status[transmission._status.downloadwait]) { e = system.panel.left.tree("find", "downloading"), s = system.panel.left.tree("getChildren", e.target), n = system.lang.tree.wait + this.showNodeMoreInfos(transmission.torrents.status[transmission._status.downloadwait].length); s.length > 0 ? system.updateTreeNodeText(s[0].id, n) : system.appendTreeNode(e, [{ id: "downloadwait", text: n, iconCls: "iconfont tr-icon-wait" }]) } else system.removeTreeNode("downloadwait"); if (system.updateTreeNodeText("actively", system.lang.tree.actively + this.showNodeMoreInfos(transmission.torrents.actively.length)), system.updateTreeNodeText("error", system.lang.tree.error + this.showNodeMoreInfos(transmission.torrents.error.length)), system.updateTreeNodeText("warning", system.lang.tree.warning + this.showNodeMoreInfos(transmission.torrents.warning.length)), null != (e = system.panel.left.tree("getSelected"))) { var o = system.control.torrentlist.datagrid("options").pageNumber; system.loadTorrentToList({ node: e, page: o }) } 0 != t && system.control.torrentlist.datagrid("selectRecord", t), system.reloading = !1, system.config.autoReload && (system.autoReloadTimer = setTimeout(function () { system.reloadData() }, system.config.reloadStep)), system.updateTreeNodeText("torrent-all", system.lang.tree.all + this.showNodeMoreInfos(transmission.torrents.count, transmission.torrents.totalSize)) }, resetNavServers: function (t) { var e = this.panel.left.tree("find", "servers"); if (this.config.nav.servers) { if (e) { var s = e.state; this.removeTreeNode("servers-loading") } else this.appendTreeNode(null, [{ id: "servers", text: this.lang.tree.servers, state: "closed", iconCls: "iconfont tr-icon-servers" }]), e = this.panel.left.tree("find", "servers"); new Array; var n = this.panel.left.tree("find", "btservers"), o = n ? n.state : "close"; for (var a in !n && system.config.showBTServers && (this.appendTreeNode(e, [{ id: "btservers", text: "BT", state: "open", iconCls: "iconfont tr-icon-bt" }]), n = this.panel.left.tree("find", "btservers")), transmission.trackers) { if (!(l = transmission.trackers[a]).isBT || system.config.showBTServers) { var r = system.panel.left.tree("find", l.nodeid), i = l.name + this.showNodeMoreInfos(l.count, l.size); r ? system.updateTreeNodeText(l.nodeid, i, l.connected ? "iconfont tr-icon-server" : "iconfont tr-icon-server-error") : system.appendTreeNode(l.isBT ? n : e, [{ id: l.nodeid, text: i, iconCls: l.connected ? "iconfont tr-icon-server" : "iconfont tr-icon-server-error" }]), t.trackers[l.nodeid] = null } } for (var a in "closed" == s && this.panel.left.tree("collapse", e.target), system.config.showBTServers && n && "closed" == o && this.panel.left.tree("collapse", n.target), t.trackers) { var l; (l = t.trackers[a]) && system.removeTreeNode(l.nodeid) } } else e && this.panel.left.tree("remove", e.target) }, resetNavStatistics: function () { if (this.config.nav.statistics) { var t = "uploadedBytes,downloadedBytes,filesAdded,sessionCount,secondsActive".split(","); $.each(t, function (t, e) { switch (e) { case "uploadedBytes": case "downloadedBytes": system.updateTreeNodeText(e, system.lang.tree.statistics[e] + " " + formatSize(system.serverSessionStats["cumulative-stats"][e])), system.updateTreeNodeText("current-" + e, system.lang.tree.statistics[e] + " " + formatSize(system.serverSessionStats["current-stats"][e])); break; case "secondsActive": system.updateTreeNodeText(e, system.lang.tree.statistics[e] + " " + getTotalTime(1e3 * system.serverSessionStats["cumulative-stats"][e])), system.updateTreeNodeText("current-" + e, system.lang.tree.statistics[e] + " " + getTotalTime(1e3 * system.serverSessionStats["current-stats"][e])); break; default: system.updateTreeNodeText(e, system.lang.tree.statistics[e] + " " + system.serverSessionStats["cumulative-stats"][e]), system.updateTreeNodeText("current-" + e, system.lang.tree.statistics[e] + " " + system.serverSessionStats["current-stats"][e]) } }) } else { var e = this.panel.left.tree("find", "statistics"); e && this.panel.left.tree("remove", e.target) } }, resetNavFolders: function (t) { if (this.config.nav.folders) { for (var e in transmission.torrents.folders) { var s = transmission.torrents.folders[e]; t.folders[s.nodeid] = null } this.loadFolderList(t.folders) } else { this.initUIStatus(); var n = this.panel.left.tree("find", "folders"); n && this.panel.left.tree("remove", n.target) } }, resetNavLabels: function (t) { if (this.config.nav.labels) { if (t) for (var e = this.panel.left.tree("getChildren", this.panel.left.tree("find", "labels").target), s = 0; s < e.length; s++)this.panel.left.tree("remove", e[s].target); for (s = 0; s < this.config.labels.length; s++) { var n = this.config.labels[s], o = "label-" + this.getValidTreeKey(n.name); (a = this.panel.left.tree("find", o)) || (this.appendTreeNode("labels", [{ id: o, text: n.name, labelIndex: s, iconCls: "iconfont tr-icon-label" }]), a = this.panel.left.tree("find", o), $(".tree-icon", a.target).css({ color: n.color }), $(".tree-title", a.target).addClass("user-label").css({ "background-color": n.color, color: getGrayLevel(n.color) > .5 ? "#000" : "#fff" })) } } else { var a; (a = this.panel.left.tree("find", "labels")) && this.panel.left.tree("remove", a.target) } }, showNodeMoreInfos: function (t, e) { var s = ""; return t > 0 && (s = " <span class='nav-torrents-number'>(" + t + ")</span>"), e > 0 && (s += "<span class='nav-total-size'>[" + formatSize(e) + "]</span>"), s }, getServerStatus: function () { this.reloading || (clearTimeout(this.autoReloadTimer), this.reloading = !0, transmission.getStatus(function (t) { if (system.reloading = !1, $("#status_downloadspeed").html(formatSize(t.downloadSpeed, !1, "speed")), $("#status_uploadspeed").html(formatSize(t.uploadSpeed, !1, "speed")), system.serverSessionStats = t, 0 == t.torrentCount) { var e = system.panel.left.tree("find", "servers"); e && system.panel.left.tree("remove", e.target), system.updateTreeNodeText("torrent-all", system.lang.tree.all) } })) }, showStatus: function (t, e) { $("#m_status").panel("options").collapsed && $("#layout_left").layout("expand", "south"), this.panel.status_text.show(), t && this.panel.status_text.html(t), 0 != e && (null == e && (e = 3e3), this.panel.status_text.fadeOut(e, function () { $("#layout_left").layout("collapse", "south") })) }, updateTreeNodeText: function (t, e, s) { var n = this.panel.left.tree("find", t); if (n) { var o = { target: n.target, text: e }; null != s && (o.iconCls = s), this.panel.left.tree("update", o) } n = null }, appendTreeNode: function (t, e) { var s = null; (s = "string" == typeof t ? this.panel.left.tree("find", t) : t) ? this.panel.left.tree("append", { parent: s.target, data: e }) : this.panel.left.tree("append", { data: e }), s = null }, removeTreeNode: function (t) { var e = this.panel.left.tree("find", t); e && this.panel.left.tree("remove", e.target), e = null }, loadTorrentToList: function (t) { if (transmission.torrents.all) { if (jQuery.extend({ node: null, page: 1 }, t), t.node) { var e = null, s = this.panel.left.tree("getParent", t.node.target) || { id: "" }, n = this.panel.left.data("currentNodeId"); switch (n != t.node.id && (this.control.torrentlist.datagrid("uncheckAll"), this.control.torrentlist.datagrid({ pageNumber: 1 }), n = t.node.id), this.panel.left.data("currentNodeId", n), s.id) { case "servers": case "btservers": e = "btservers" == t.node.id ? transmission.torrents.btItems : transmission.trackers[t.node.id].torrents; break; default: switch (t.node.id) { case "torrent-all": case "servers": e = transmission.torrents.all; break; case "paused": e = transmission.torrents.status[transmission._status.stopped]; break; case "sending": e = transmission.torrents.status[transmission._status.seed]; break; case "seedwait": e = transmission.torrents.status[transmission._status.seedwait]; break; case "check": e = transmission.torrents.status[transmission._status.check]; break; case "checkwait": e = transmission.torrents.status[transmission._status.checkwait]; break; case "downloading": e = transmission.torrents.status[transmission._status.download]; break; case "downloadwait": e = transmission.torrents.status[transmission._status.downloadwait]; break; case "actively": e = transmission.torrents.actively; break; case "error": e = transmission.torrents.error; break; case "warning": e = transmission.torrents.warning; break; case "search-result": e = transmission.torrents.searchResult; break; case "btservers": e = transmission.torrents.btItems; break; default: if (-1 != t.node.id.indexOf("folders-")) { var o = transmission.torrents.folders[t.node.id]; if (o) if (this.config.hideSubfolders) { e = []; for (var a = 0; a < o.torrents.length; a++) { var r = o.torrents[a]; r.downloadDir.replace(/[\\|\/]/g, "") == t.node.path && e.push(r) } } else e = o.torrents } else if (-1 != t.node.id.indexOf("label-")) { var i = parseInt(t.node.labelIndex); for (var l in e = [], transmission.torrents.all) { var d = transmission.torrents.all[l]; (f = this.config.labelMaps[d.hashString]) && -1 != $.inArray(i, f) && e.push(d) } } } }this.config.defaultSelectNode != t.node.id && (this.control.torrentlist.datagrid("loadData", []), this.config.defaultSelectNode = t.node.id, this.saveConfig()); var c = new Array; for (var a in e) { if (!e[a]) return; var u = this.lang.torrent["status-text"][e[a].status]; 0 != e[a].error ? u = "<span class='text-status-error'>" + u + "</span>" : e[a].warning && (u = "<span class='text-status-warning' title='" + e[a].warning + "'>" + u + "</span>"); var f, h = {}; (h = $.extend(h, e[a])).status = u, h.statusCode = e[a].status, h.completeSize = Math.max(0, e[a].totalSize - e[a].leftUntilDone), h.leecherCount = e[a].leecher, h.seederCount = e[a].seeder, (f = this.config.labelMaps[h.hashString]) && (h.labels = f), c.push(h) } this.updateTorrentCurrentPageDatas(c), this.initShiftCheck() } } }, initShiftCheck: function () { var t = $("#m_list div.datagrid-cell-check input:checkbox"); t.off("click.Shift"); var e = null, s = this.control.torrentlist; t.on("click.Shift", function (n) { if (e) { if (n.shiftKey) for (var o = t.index(this), a = t.index(e), r = e.checked, i = Math.min(o, a), l = Math.max(o, a) + 1, d = i; d < l; d++)r ? s.datagrid("checkRow", d) : s.datagrid("uncheckRow", d); e = this } else e = this }) }, updateTorrentCurrentPageDatas: function (t) { var e = this.control.torrentlist.datagrid("getRows"); if (0 == t.length && e.length > 0) this.control.torrentlist.datagrid("loadData", []); else { var s = this.control.torrentlist.datagrid("options"), n = null; if (s.sortName) { var o = n = s.sortName; t = t.sort(arrayObjectSort(o, s.sortOrder)) } if (0 == e.length || t.length != this.control.torrentlist.datagrid("getData").total && t.length > s.pageSize) this.control.torrentlist.datagrid({ loadFilter: pagerFilter, pageNumber: s.pageNumber, sortName: n, sortOrder: s.sortOrder }).datagrid("loadData", t); else { this.control.torrentlist.datagrid("getData").originalRows = t; var a = (s.pageNumber - 1) * parseInt(s.pageSize), r = a + parseInt(s.pageSize); t = t.slice(a, r); var i = {}, l = {}; for (var d in transmission.torrents.recently) { i[(f = transmission.torrents.recently[d]).id] = !0, f = null } for (var d in t) { l[(f = t[d]).id] = f, f = null } var c = {}; for (d = e.length - 1; d >= 0; d--) { var u = l[(f = e[d]).id]; u ? i[f.id] ? (this.control.torrentlist.datagrid("updateRow", { index: d, row: u }), c[f.id] = f) : transmission.torrents.removed && transmission.torrents.removed.length > 0 && -1 != $.inArray(f.id, transmission.torrents.removed) ? this.control.torrentlist.datagrid("deleteRow", d) : c[f.id] = f : this.control.torrentlist.datagrid("deleteRow", d), f = null, u = null } for (var d in t) { var f; c[(f = t[d]).id] || this.control.torrentlist.datagrid("appendRow", f) } e = null, i = null, l = null } } }, getTorrentNameBar: function (t) { var e = "", s = t.name; switch (t.status) { case transmission._status.stopped: e = "iconlabel icon-pause-small"; break; case transmission._status.check: e = "iconlabel icon-checking"; break; case transmission._status.download: e = "iconlabel icon-down"; break; case transmission._status.seed: e = "iconlabel icon-up"; break; case transmission._status.seedwait: case transmission._status.downloadwait: case transmission._status.checkwait: e = "iconlabel icon-wait" }return s += "\n" + t.downloadDir, t.warning && (e = "iconlabel icon-warning-type1", s += "\n\n" + this.lang.public["text-info"] + ": " + t.warning), 0 != t.error && (e = "iconlabel icon-exclamation", s += "\n\n" + this.lang.public["text-info"] + ": " + t.errorString), '<span class="' + e + '" title="' + s + '">' + t.name + "</span>" }, getTorrentProgressBar: function (t, e) { var s = "", n = 0; switch (n = "object" == typeof e ? e.status : e) { case transmission._status.stopped: s = "torrent-progress-stop"; break; case transmission._status.checkwait: case transmission._status.check: s = "torrent-progress-check"; break; case transmission._status.downloadwait: case transmission._status.download: s = "torrent-progress-download"; break; case transmission._status.seedwait: case transmission._status.seed: s = "torrent-progress-seed" }return "object" == typeof e && (e.warning && (s = "torrent-progress-warning"), 0 != e.error && (s = "torrent-progress-error")), n == transmission._status.check ? '<div class="torrent-progress" title="' + t + '%"><div class="torrent-progress-text" style="z-index:2;">' + parseFloat(100 * e.recheckProgress).toFixed(2) + '%</div><div class="torrent-progress-bar torrent-progress-seed" style="width:' + parseFloat(t * e.recheckProgress).toFixed(2) + '%;z-index:1;opacity:0.7;"></div><div class="torrent-progress-bar ' + s + '" style="width:' + t + '%;"></div></div>' : '<div class="torrent-progress" title="' + (t += "%") + '"><div class="torrent-progress-text">' + t + '</div><div class="torrent-progress-bar ' + s + '" style="width:' + t + ';"></div></div>' }, addTorrentsToServer: function (t, e, s, n, o) { var a = e - t.length, r = t.shift(); if (!r) return this.showStatus(this.lang.system.status.queuefinish), this.getServerStatus(), void (null != o && system.saveConfig()); this.showStatus(this.lang.system.status.queue + (a + 1) + "/" + e + "<br/>" + r, 0), transmission.addTorrentFromUrl(r, n, s, function (a) { system.addTorrentsToServer(t, e, s, n, o), null != o && null != a.hashString && system.saveLabelsConfig(a.hashString, o) }) }, changeSelectedTorrentStatus: function (t, e, s) { var n = this.control.torrentlist.datagrid("getChecked"), o = new Array; for (var a in t || (t = "start"), n) o.push(n[a].id); if (s || (s = "torrent-" + t), o.length > 0) { if (e) { var r = e.linkbutton("options").iconCls; e.linkbutton({ disabled: !0, iconCls: "icon-loading" }) } transmission.exec({ method: s, arguments: { ids: o } }, function (t) { e && e.linkbutton({ iconCls: r }), system.control.torrentlist.datagrid("uncheckAll"), system.reloadTorrentBaseInfos() }) } }, getTorrentMagnetLink: function (t) { var e = this.control.torrentlist.datagrid("getChecked"), s = new Array; for (var n in e) s.push(e[n].id); transmission.torrents.getMagnetLink(s, t) }, searchTorrents: function (t) { if ("" != t) { var e = transmission.torrents.search(t); if (null != e && 0 != e.length) { var s = this.panel.left.tree("find", "search-result"), n = this.lang.tree["search-result"] + " : " + t + " (" + e.length + ")"; null == s ? (this.appendTreeNode("torrent-all", [{ id: "search-result", text: n, iconCls: "iconfont tr-icon-search" }]), s = this.panel.left.tree("find", "search-result")) : this.panel.left.tree("update", { target: s.target, text: n }), this.panel.left.tree("select", s.target) } else this.removeTreeNode("search-result") } }, getTorrentInfos: function (t) { if (transmission.torrents.all[t] && !transmission.torrents.all[t].infoIsLoading && !(this.currentTorrentId > 0 && transmission.torrents.all[this.currentTorrentId] && transmission.torrents.all[this.currentTorrentId].infoIsLoading || (this.currentTorrentId = t, this.panel.attribute.panel("options").collapsed))) { var e = transmission.torrents.all[t]; e.infoIsLoading = !0; var s = "fileStats,trackerStats,peers,leftUntilDone,status,rateDownload,rateUpload,uploadedEver,uploadRatio,error,errorString,pieces,pieceCount,pieceSize"; e.moreInfosTag || (s += ",files,trackers,comment,dateCreated,creator,downloadDir"), transmission.torrents.getMoreInfos(s, t, function (s) { e.infoIsLoading = !1, null != s && (jQuery.extend(e, s[0]), 0 != system.currentTorrentId && system.currentTorrentId == t ? (e.completeSize = e.totalSize - e.leftUntilDone, "files" in e && e.files.length > 0 && (e.moreInfosTag = !0), system.fillTorrentBaseInfos(e), system.fillTorrentFileList(e), system.fillTorrentServerList(e), system.fillTorrentPeersList(e), system.fillTorrentConfig(e), transmission.torrents.all[t] = e, transmission.torrents.datas[t] = e) : system.clearTorrentAttribute()) }) } }, clearTorrentAttribute: function () { system.panel.attribute.find("#torrent-files-table").datagrid("loadData", []), system.panel.attribute.find("#torrent-servers-table").datagrid("loadData", []), system.panel.attribute.find("#torrent-peers-table").datagrid("loadData", []), system.panel.attribute.find("span[id*='torrent-attribute-value']").html("") }, updateCurrentPageDatas: function (t, e, s) { var n = s.datagrid("getRows"), o = s.datagrid("options"), a = null; o.sortName && (a = o.sortName, e = e.sort(arrayObjectSort(a, o.sortOrder))); var r = -1 != s.selector.indexOf("#torrent-files-table"), i = s.datagrid("getData"), l = r && !!i.filterString && i.torrentId == system.currentTorrentId; if (l && (e = fileFilter(e, i.filterString)), 0 != l || 0 != n.length && e.length == i.total) { s.datagrid("getData").originalRows = e; var d = (o.pageNumber - 1) * parseInt(o.pageSize), c = d + parseInt(o.pageSize); e = e.slice(d, c); var u = {}; for (var f in e) { u[(h = e[f])[t]] = h, h = null } for (f = n.length - 1; f >= 0; f--) { var h, m = u[(h = n[f])[t]]; m ? s.datagrid("updateRow", { index: f, row: m }) : s.datagrid("deleteRow", f), m = null, h = null } } else s.datagrid({ loadFilter: pagerFilter, pageNumber: 1, sortName: a, sortOrder: o.sortOrder }).datagrid("loadData", e) }, fillTorrentBaseInfos: function (t) { $.each(t, function (t, e) { switch (t) { case "rateDownload": case "rateUpload": e = formatSize(e, !0, "speed"); break; case "totalSize": case "uploadedEver": case "leftUntilDone": case "completeSize": e = formatSize(e); break; case "addedDate": case "dateCreated": case "doneDate": e = formatLongTime(e); break; case "status": e = system.lang.torrent["status-text"][e]; break; case "error": 0 == e ? system.panel.attribute.find("#torrent-attribute-tr-error").hide() : system.panel.attribute.find("#torrent-attribute-tr-error").show(); break; case "remainingTime": e = e >= 31536e8 ? "" : getTotalTime(e); break; case "comment": e = system.replaceURI(e) }system.panel.attribute.find("#torrent-attribute-value-" + t).html(e) }); for (var e = (new Base64).decode_bytes(t.pieces), s = 0, n = t.pieceCount, o = t.pieceSize, a = []; s < n;)for (var r = e.codePointAt(s >> 3), i = 128; i > 0 && s < n; i >>= 1, ++s)a.push(!(r & i)); var l = parseInt((499 + n) / 500), d = formatSize(o * l), c = parseInt((l - 1 + n) / l), u = 0, f = ""; for (u = 0, s = 0; u < c; ++u) { for (var h = l, m = 0; m < l; ++m, ++s)a[s] && --h; var p = parseInt(100 * h / l), g = p / 100; f += '<i style="filter:saturate(' + parseInt(100 * (Math.pow(128, g) - 1) / 127) / 100 + ')" title="' + d + " x " + p + '%"></i>' } system.panel.attribute.find("#torrent-attribute-pieces").html(f) }, fillTorrentFileList: function (t) { var e = t.files, s = t.fileStats, n = new Array, o = t.name.length + 1; for (var a in e) { var r = e[a], i = s[a], l = parseFloat(i.bytesCompleted / r.length * 100).toFixed(2); n.push({ name: r.name == t.name ? r.name : r.name.substr(o), index: a, bytesCompleted: i.bytesCompleted, percentDone: system.getTorrentProgressBar(l, transmission._status.download), length: r.length, wanted: system.lang.torrent.attribute.status[i.wanted], priority: '<span class="iconlabel icon-flag-' + i.priority + '">' + system.lang.torrent.attribute.priority[i.priority] + "</span>" }) } this.updateCurrentPageDatas("index", n, system.panel.attribute.find("#torrent-files-table")) }, fillTorrentServerList: function (t) { var e = t.trackerStats, s = new Array; for (var n in e) { var o = e[n], a = {}; for (var r in o) switch (r) { case "downloadCount": case "leecherCount": case "seederCount": a[r] = -1 == o[r] ? system.lang.public["text-unknown"] : o[r]; break; case "announceState": a[r] = system.lang.torrent.attribute["servers-fields"].announceStateText[o[r]]; break; case "lastAnnounceTime": case "nextAnnounceTime": a[r] = formatLongTime(o[r]); break; case "lastAnnounceSucceeded": case "lastAnnounceTimedOut": a[r] = system.lang.torrent.attribute.status[o[r]]; break; default: a[r] = o[r] }s.push(a) } transmission.torrents.addTracker(t), this.updateCurrentPageDatas("id", s, system.panel.attribute.find("#torrent-servers-table")) }, fillTorrentPeersList: function (t) { var e = t.peers, s = new Array; for (var n in e) { var o = e[n], a = {}; for (var r in o) a[r] = o[r]; if ("" !== system.config.ipInfoToken) { let t = "", e = a.address; if (void 0 === this.flags[e]) { let s = { url: "https://ipinfo.io/" + e + "/country?token=" + system.config.ipInfoToken, method: "GET", async: !1 }; $.ajax(s).done(function (e) { t = e.toLowerCase().trim() }), this.flags[e] = t } else t = this.flags[e]; a.address += ' <img src="' + this.rootPath + "/style/flags/" + t + '.png" alt="' + t + '" title="' + t + '">' } a.isUTP = system.lang.torrent.attribute.status[o.isUTP]; var i = parseFloat(100 * o.progress).toFixed(2); a.progress = system.getTorrentProgressBar(i, transmission._status.download), s.push(a) } this.updateCurrentPageDatas("address", s, system.panel.attribute.find("#torrent-peers-table")) }, fillTorrentConfig: function (t) { 4 == system.panel.attribute.find("#torrent-attribute-tabs").data("selectedIndex") && transmission.torrents.getConfig(t.id, function (t) { if (null != t) { var e = transmission.torrents.all[system.currentTorrentId]; jQuery.extend(e, t[0]), 0 != system.currentTorrentId && $.each(t[0], function (t, e) { var s = !1, n = !1, o = !1; switch (t) { case "seedIdleMode": case "seedRatioMode": 0 == e && (n = !1, s = !0), o = !0; case "downloadLimited": case "uploadLimited": 1 != e && 1 != e || (n = !0), system.panel.attribute.find("input[enabledof='" + t + "']").prop("disabled", !n), o && system.panel.attribute.find("#" + t).prop("indeterminate", s).data("_tag", e), system.panel.attribute.find("#" + t).prop("checked", n); break; default: system.panel.attribute.find("#" + t).val(e), system.panel.attribute.find("#" + t).numberspinner("setValue", e) } }) } }) }, setFieldFormat: function (t) { if (t.formatter) switch (t.formatter) { case "size": t.formatter = function (t, e, s) { return formatSize(t) }; break; case "speed": t.formatter = function (t, e, s) { return formatSize(t, !0, "speed") }; break; case "longtime": t.formatter = function (t, e, s) { return formatLongTime(t) }; break; case "progress": t.formatter = function (t, e, s) { var n = parseFloat(100 * t).toFixed(2); return system.getTorrentProgressBar(n, transmission.torrents.all[e.id]) }; break; case "_usename_": switch (t.field) { case "name": t.formatter = function (t, e, s) { return system.getTorrentNameBar(transmission.torrents.all[e.id]) } }break; case "ratio": t.formatter = function (t, e, s) { var n = ""; return parseFloat(t) < 1 && -1 != t && (n = "text-status-warning"), '<span class="' + n + '">' + (-1 == t ? "" : t) + "</span>" }; break; case "remainingTime": t.formatter = function (t, e, s) { return t >= 31536e8 ? "" : getTotalTime(t) }; break; case "labels": t.formatter = function (t, e, s) { return system.formetTorrentLabels(t, e.hashString) }; break; case "color": t.formatter = function (t, e, s) { return $("<span class='user-label'/>").html(t).css({ "background-color": t, color: getGrayLevel(t) > .5 ? "#000" : "#fff" }).get(0).outerHTML } } }, reloadData: function () { this.popoverCount > 0 ? setTimeout(function () { system.reloadData() }, 2e3) : (this.reloadSession(), this.reloading = !1, this.getServerStatus(), this.reloading = !1, this.reloadTorrentBaseInfos()) }, loadFolderList: function (t) { for (var e in this.removeTreeNode("folders-loading"), t) { var s = t[e]; s && system.removeTreeNode(s.nodeid) } 0 != transmission.downloadDirs.length && timedChunk(transmission.downloadDirs, this.appendFolder, this, 10, function () { "Firefox" == $.ua.browser.name && $.ua.browser.major < 60 && system.panel.left.find("span.nav-total-size").css({ "margin-top": "-19px" }), system.initUIStatus() }) }, appendFolder: function (t) { if (t) { var e = "folders", s = t.replace(/\\/g, "/").split("/"), n = "folders-", o = ""; for (var a in s) { var r = s[a]; if ("" != r) { o += r, n += this.B64.encode(r).replace(/[+|\/|=]/g, "0"); var i = this.panel.left.tree("find", n), l = transmission.torrents.folders[n]; if (l) { var d = r + this.showNodeMoreInfos(l.count, l.size); i ? this.updateTreeNodeText(n, d) : (this.appendTreeNode(e, [{ id: n, path: o, downDir: t, text: d, iconCls: "iconfont tr-icon-file" }]), "folders" != e && (i = this.panel.left.tree("find", e), this.panel.left.tree("collapse", i.target))), e = n } else this.debug("appendFolder:key", n), this.debug("appendFolder:name", r), this.debug("appendFolder:node", i) } } } }, replaceURI: function (t) { return t.replace(/(http|https|ftp):\/\/([^/:]+)(:\d*)?([^# ]*)/gi, function (t) { return '<a href="' + t + '" target="_blank">' + t + "</a>" }) }, readConfig: function () { this.readUserConfig(); var t = this.getStorageData(this.configHead + ".system"); for (var e in t && (this.config = $.extend(!0, this.config, JSON.parse(t))), this.storageKeys.dictionary) this.dictionary[e] = this.getStorageData(this.storageKeys.dictionary[e]) }, saveConfig: function () { for (var t in this.setStorageData(this.configHead + ".system", JSON.stringify(this.config)), this.storageKeys.dictionary) this.setStorageData(this.storageKeys.dictionary[t], this.dictionary[t]); this.saveUserConfig() }, saveLabelsConfig: function (t, e) { system.config.nav.labels && (0 == e.length ? delete system.config.labelMaps[t] : system.config.labelMaps[t] = e) }, readUserConfig: function () { var t = window.localStorage[this.configHead]; if (t) { var e = JSON.parse(t); this.userConfig = $.extend(!0, this.userConfig, e) } }, saveUserConfig: function () { window.localStorage[this.configHead] = JSON.stringify(this.userConfig) }, uploadTorrentFile: function (t, e, s, n) { if (window.FileReader) { var o = $("input[id='" + t + "']")[0].files; $.each(o, function (t, a) { transmission.addTorrentFromFile(a, e, s, n, o.length) }) } else alert(system.lang.public["text-browsers-not-support-features"]) }, checkUpdate: function () { $.ajax({ url: this.checkUpdateScript, dataType: "json", success: function (t) { if (t && t.tag_name) { var e = t.created_at.substr(0, 10).replace(/-/g, ""), s = t.tag_name; if (-1 != $.inArray(s, system.config.ignoreVersion)) return; if (system.codeupdate < e) { $("#area-update-infos").show(), $("#msg-updateInfos").html(e + " -> " + t.name); var n = $("<div/>"), o = t.body.replace(/\r\n/g, "<br/>"), a = $("<div style='text-align:right;'/>").appendTo(n); $('<a href="https://github.com/ronggang/transmission-web-control/releases/latest" target="_blank" class="easyui-linkbutton" data-options="iconCls:\'iconfont tr-icon-github\'"/>').html(t.name + " (" + e + ")").appendTo(a).linkbutton(), $("<span/>").html(" ").appendTo(a), $('<a href="https://github.com/ronggang/transmission-web-control/wiki" target="_blank" class="easyui-linkbutton" data-options="iconCls:\'iconfont tr-icon-help\'"/>').html(system.lang.public["text-how-to-update"]).appendTo(a).linkbutton(), $("<span/>").html(" ").appendTo(a), $("<button onclick=\"javascript:system.addIgnoreVersion('" + s + '\');" class="easyui-linkbutton" data-options="iconCls:\'iconfont tr-icon-cancel-checked\'"/>').html(system.lang.public["text-ignore-this-version"]).appendTo(a).linkbutton(), $("<hr/>").appendTo(n), $("<div/>").html(o).appendTo(n), $("#button-download-update").webuiPopover({ content: n.html(), backdrop: !0 }) } else $("#area-update-infos").hide() } } }) }, addIgnoreVersion: function (t) { -1 == $.inArray(t, system.config.ignoreVersion) && (this.config.ignoreVersion.push(t), this.saveConfig()), $("#button-download-update").webuiPopover("hide"), $("#area-update-infos").hide() }, changeLanguages: function (t) { t != this.lang.name && t && (this.config.defaultLang = t, this.saveConfig(), location.href = "?lang=" + t) }, getStorageData: function (t, e) { return null == window.localStorage[t] ? e : window.localStorage[t] }, setStorageData: function (t, e) { window.localStorage[t] = e }, openDialogFromTemplate: function (t) { if (null != (t = $.extend(!0, { id: null, options: null, datas: null, type: 0 }, t)).id) { var e = t.id, s = t.options, n = t.datas, o = $("#" + e); if (o.length) { if (n && $.each(n, function (t, e) { o.data(t, e) }), 0 == t.type && o.attr("type") == t.type) return o.dialog("open"), void o.dialog({ content: system.templates[e] }); if (0 != system.popoverCount) return void setTimeout(function () { system.openDialogFromTemplate(t) }, 350); o.remove() } var a = { title: "", width: 100, height: 100, resizable: !1, cache: !0, content: system.lang.dialog["system-config"].loading, modal: !0 }; s = $.extend(!0, a, s), o = $("<div/>").attr({ id: e, type: t.type }).appendTo(document.body), 0 == t.type ? o.dialog(s) : (o.css({ width: s.width, height: s.height }).data("popoverSource", t.source), $(t.source).webuiPopover({ url: "#" + e, title: s.title, width: s.width, height: s.height - 18, padding: !1, onHide: function (s) { $(t.source).webuiPopover("destroy"), $("#" + e).remove(), $(s).remove(), system.popoverCount--, t.onClose && t.onClose(t.source) }, onShow: function () { system.popoverCount++ } })), $.get(system.rootPath + "template/" + e + ".html?time=" + new Date, function (s) { system.templates[e] = s, n && $.each(n, function (t, s) { $("#" + e).data(t, s) }), 0 == t.type ? $("#" + e).dialog({ content: s }) : (o.html(s), $.parser.parse("#" + e), $(t.source).webuiPopover("show")) }) } }, debug: function (t, e) { window.console && window.console.log && window.console.log(t, e) }, initThemes: function () { this.themes && $("#select-themes").combobox({ groupField: "group", data: this.themes, editable: !1, panelHeight: "auto", onChange: function (t) { var e = (t + ";").split(";"), s = e[0], n = e[1] || "logo.png"; $("#styleEasyui").attr("href", "tr-web-control/script/easyui/themes/" + s + "/easyui.css"), $("#logo").attr("src", "tr-web-control/" + n), system.config.theme = t, system.saveConfig() }, onLoadSuccess: function () { $(this).combobox("setValue", system.config.theme || "default") } }) }, getValidTreeKey: function (t) { return t ? this.B64.encode(t).replace(/[+|\/|=]/g, "0") : "" } }; function fileFilter(t, e) { for (var s = new RegExp(e || ".*"), n = new Array, o = 0; o < t.length; ++o)s.test(t[o].name) && n.push(t[o]); return n } function restoreFileFilterInputbox(t) { var e = system.lang.torrent.attribute["filter-template-text"], s = [{ id: 1, text: e ? e[1] : "All", desc: ".*" }, { id: 2, text: e ? e[2] : "BitComet padding file", desc: "____padding_file" }, { id: 3, text: e ? e[3] : "Unnecessary files", desc: "(.*\\.(url|lnk)$)|(RARBG_DO_NOT_MIRROR\\.exe)|(____padding_file)" }]; $('<input id="torrent-files-filter-string" style="width:300px;">').insertAfter("#torrent-files-filter").combobox({ valueField: "desc", textField: "desc", panelWidth: 400, panelHeight: "auto", formatter: function (t) { return '<span style="font-weight:bold; padding:3px;">' + t.text + '</span><br/><span style="padding-left:10px;">' + t.desc + "</span>" } }).combobox("loadData", s).combobox("setValue", t) } function pagerFilter(t) { var e, s = !1; if ("number" == typeof t.length && "function" == typeof t.splice && (t = { total: t.length, rows: t }), e = "torrent-files-table" == this.id) { var n = $("#torrent-files-filter-string").val(); if (s = t.filterString !== n || t.filterString && t.originalRows.length == t.unfilteredRows.length) { t.torrentId = system.currentTorrentId; var o = t.unfilteredRows || t.originalRows || t.rows, a = fileFilter(o, n); t.originalRows = a, t.total = a.length, t.unfilteredRows || (t.unfilteredRows = o), t.filterString = n } } var r = $(this), i = r.datagrid("options"), l = r.datagrid("getPager"), d = r.data("buttons"); l.pagination({ onSelectPage: function (e, s) { i.pageNumber = e, i.pageSize = s, l.pagination("refresh", { pageNumber: e, pageSize: s }), r.datagrid("loadData", t) }, buttons: d }), t.originalRows || (t.originalRows = t.rows); var c = s ? 0 : (i.pageNumber - 1) * parseInt(i.pageSize), u = c + parseInt(i.pageSize); if (t.rows = t.originalRows.slice(c, u), d && d.length) for (var f = 0; f < d.length; f++) { var h = d[f]; h.id && h.title && $("#" + h.id, l).attr("title", h.title) } return e && restoreFileFilterInputbox(n), t } $(document).ready(function () { $.getJSON(system.rootPath + "i18n/en.json").done(function (t) { system.defaultLang = t }), $.getJSON(system.rootPath + "i18n.json").done(function (t) { system.languages = t, system.init(location.search.getQueryString("lang"), location.search.getQueryString("local")) }) });